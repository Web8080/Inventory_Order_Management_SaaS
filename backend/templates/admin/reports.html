{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block extrahead %}
    {{ block.super }}
    <style>
        .reports-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .reports-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .reports-header h1 {
            margin: 0 0 10px 0;
            font-size: 2.5em;
        }
        
        .reports-header p {
            margin: 0;
            opacity: 0.9;
            font-size: 1.1em;
        }
        
        .date-filter {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .date-filter form {
            display: flex;
            gap: 20px;
            align-items: end;
        }
        
        .date-filter .form-group {
            flex: 1;
        }
        
        .date-filter label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2d3748;
        }
        
        .date-filter input {
            width: 100%;
            padding: 10px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 1em;
        }
        
        .date-filter button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .date-filter button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .stat-card h3 {
            margin: 0 0 10px 0;
            font-size: 2.5em;
            color: #667eea;
        }
        
        .stat-card p {
            margin: 0;
            color: #718096;
            font-size: 1.1em;
        }
        
        .report-section {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .report-section h3 {
            margin: 0 0 20px 0;
            color: #2d3748;
            font-size: 1.5em;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 10px;
        }
        
        .export-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .export-btn {
            background: #38a169;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .export-btn:hover {
            background: #2f855a;
            transform: translateY(-2px);
            text-decoration: none;
            color: white;
        }
        
        .table-container {
            overflow-x: auto;
        }
        
        .report-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .report-table th,
        .report-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .report-table th {
            background: #f7fafc;
            font-weight: 600;
            color: #2d3748;
        }
        
        .report-table tr:hover {
            background: #f7fafc;
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }
        
        .status-active {
            background: #c6f6d5;
            color: #22543d;
        }
        
        .status-inactive {
            background: #fed7d7;
            color: #742a2a;
        }
        
        .status-low-stock {
            background: #fef5e7;
            color: #744210;
        }
        
        .status-in-stock {
            background: #c6f6d5;
            color: #22543d;
        }
        
        @media (max-width: 768px) {
            .date-filter form {
                flex-direction: column;
            }
            
            .export-buttons {
                flex-direction: column;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
{% endblock %}

{% block content %}
<div class="reports-container">
    <div class="reports-header">
        <h1>üìä Admin Reports & Analytics</h1>
        <p>Comprehensive business intelligence and reporting dashboard</p>
    </div>
    
    <!-- Date Filter -->
    <div class="date-filter">
        <form method="get">
            <div class="form-group">
                <label for="start_date">Start Date</label>
                <input type="date" id="start_date" name="start_date" value="{{ start_date }}">
            </div>
            <div class="form-group">
                <label for="end_date">End Date</label>
                <input type="date" id="end_date" name="end_date" value="{{ end_date }}">
            </div>
            <button type="submit">Update Reports</button>
        </form>
    </div>
    
    <!-- Key Statistics -->
    <div class="stats-grid">
        <div class="stat-card">
            <h3>${{ total_sales|floatformat:2 }}</h3>
            <p>Total Sales Revenue</p>
        </div>
        <div class="stat-card">
            <h3>{{ total_orders }}</h3>
            <p>Total Orders</p>
        </div>
        <div class="stat-card">
            <h3>${{ avg_order_value|floatformat:2 }}</h3>
            <p>Average Order Value</p>
        </div>
        <div class="stat-card">
            <h3>{{ low_stock_items.count }}</h3>
            <p>Low Stock Items</p>
        </div>
    </div>
    
    <!-- Export Buttons -->
    <div class="export-buttons">
        <a href="?export=sales&start_date={{ start_date }}&end_date={{ end_date }}" class="export-btn">
            üìà Export Sales Report
        </a>
        <a href="?export=inventory&start_date={{ start_date }}&end_date={{ end_date }}" class="export-btn">
            üì¶ Export Inventory Report
        </a>
        <a href="?export=tenants&start_date={{ start_date }}&end_date={{ end_date }}" class="export-btn">
            üè¢ Export Tenant Report
        </a>
        <a href="?export=integrations&start_date={{ start_date }}&end_date={{ end_date }}" class="export-btn">
            üîó Export Integration Report
        </a>
    </div>
    
    <!-- Top Products Report -->
    <div class="report-section">
        <h3>üèÜ Top Products by Revenue</h3>
        <div class="table-container">
            <table class="report-table">
                <thead>
                    <tr>
                        <th>Product Name</th>
                        <th>SKU</th>
                        <th>Units Sold</th>
                        <th>Total Revenue</th>
                    </tr>
                </thead>
                <tbody>
                    {% for product in top_products %}
                    <tr>
                        <td>{{ product.product__name }}</td>
                        <td>{{ product.product__sku }}</td>
                        <td>{{ product.total_sold }}</td>
                        <td>${{ product.total_revenue|floatformat:2 }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="4" style="text-align: center; color: #718096;">No sales data available for the selected period</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Tenant Performance Report -->
    <div class="report-section">
        <h3>üè¢ Tenant Performance</h3>
        <div class="table-container">
            <table class="report-table">
                <thead>
                    <tr>
                        <th>Tenant Name</th>
                        <th>Plan</th>
                        <th>Orders</th>
                        <th>Revenue</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for tenant in tenant_performance %}
                    <tr>
                        <td>{{ tenant.name }}</td>
                        <td>{{ tenant.get_plan_display }}</td>
                        <td>{{ tenant.total_orders }}</td>
                        <td>${{ tenant.total_revenue|floatformat:2 }}</td>
                        <td>
                            <span class="status-badge {% if tenant.is_active %}status-active{% else %}status-inactive{% endif %}">
                                {% if tenant.is_active %}Active{% else %}Inactive{% endif %}
                            </span>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" style="text-align: center; color: #718096;">No tenant data available</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Low Stock Items Report -->
    <div class="report-section">
        <h3>‚ö†Ô∏è Low Stock Items</h3>
        <div class="table-container">
            <table class="report-table">
                <thead>
                    <tr>
                        <th>Product Name</th>
                        <th>SKU</th>
                        <th>Warehouse</th>
                        <th>Current Stock</th>
                        <th>Reorder Point</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in low_stock_items %}
                    <tr>
                        <td>{{ item.product.name }}</td>
                        <td>{{ item.product.sku }}</td>
                        <td>{{ item.warehouse.name }}</td>
                        <td>{{ item.quantity }}</td>
                        <td>{{ item.reorder_point }}</td>
                        <td>
                            <span class="status-badge status-low-stock">Low Stock</span>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" style="text-align: center; color: #718096;">No low stock items found</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Integration Status Report -->
    <div class="report-section">
        <h3>üîó Integration Status</h3>
        <div class="table-container">
            <table class="report-table">
                <thead>
                    <tr>
                        <th>Integration Type</th>
                        <th>Total</th>
                        <th>Active</th>
                        <th>Inactive</th>
                    </tr>
                </thead>
                <tbody>
                    {% for status in integration_status %}
                    <tr>
                        <td>{{ status.integration_type|title }}</td>
                        <td>{{ status.total }}</td>
                        <td>{{ status.active }}</td>
                        <td>{{ status.total|add:"-"|add:status.active }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="4" style="text-align: center; color: #718096;">No integration data available</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

